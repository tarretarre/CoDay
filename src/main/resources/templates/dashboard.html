<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="sv">
<head>
    <meta charset="UTF-8">
    <title>Kontorspoäng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-5">

    <h1 class="mb-4">
        Välkommen, <span th:text="${user.firstName} + ' ' + ${user.lastName}">Användare</span>!
    </h1>

    <p>Poäng: <strong th:text="${user.points}">0</strong></p>

    <div class="mb-4">
        <form th:if="${currentVisit == null}" th:action="@{/visits/present}" method="post">
            <button type="submit" class="btn btn-sm btn-success">Present (Checka in)</button>
        </form>

        <form th:if="${currentVisit != null}" th:action="@{/visits/away}" method="post">
            <button type="submit" class="btn btn-sm btn-warning">Away (Checka ut)</button>
        </form>
    </div>

    <div th:if="${currentVisit != null}" class="text-muted mt-2">
        <span id="elapsedTime" th:data-start="${#temporals.format(currentVisit.checkInTime, 'yyyy-MM-dd''T''HH:mm:ss')}"></span>
    </div>

    <h2 class="mt-5">Tillgängliga produkter</h2>
    <ul class="list-group">
        <li class="list-group-item d-flex justify-content-between align-items-center"
            th:each="product : ${products}">
            <span>
                <strong th:text="${product.name}">Produkt</strong>
                – <span th:text="${product.pointsCost}">0</span> poäng
            </span>
            <form th:action="@{'/purchase/' + ${user.id} + '/' + ${product.id}}" method="post">
                <button type="submit" class="btn btn-sm btn-primary">Köp</button>
            </form>
        </li>
    </ul>

    <div class="mt-4">
        <a href="/" class="btn btn-link">← Till startsidan</a>
    </div>

</div>
<!-- Laddar Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Din egna JavaScript för att visa tickande tid -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const elem = document.getElementById("elapsedTime");
        if (elem) {
            const start = new Date(elem.dataset.start);

            function pad(n) {
                return n.toString().padStart(2, '0');
            }

            function updateElapsed() {
                const now = new Date();
                const diffMs = now - start;
                const totalSeconds = Math.floor(diffMs / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;

                elem.textContent = `Pågående tid: ${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
            }

            updateElapsed();
            setInterval(updateElapsed, 1000);
        }
    });
</script>
</body>
</html>
